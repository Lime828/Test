<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AVDTech Â· Smart Onboarding</title>
  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <!-- Babel & React via CDN -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(145deg, #f3f9f5 0%, #ecf3ea 100%);
      min-height: 100vh;
    }

    .glass-card {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.7);
    }

    .fade-in {
      animation: fadeIn 0.4s ease-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>

<body>
  <div id="root"></div>

  <script type="text/babel" data-type="module">
    import React, { useState, useEffect, useRef } from 'https://esm.sh/react@19.2.4';
    import ReactDOM from 'https://esm.sh/react-dom@19.2.4/client';
    import { GoogleGenerativeAI } from 'https://esm.sh/@google/generative-ai@0.21.0';

    // --- Configuration ---
    const API_KEY = "";
    const GOOGLE_SHEET_URL = "https://script.google.com/macros/s/AKfycbxJT5_UrvTVT-fJSePLgOaRMFsfhOIkRFuS68xjovYJDEnotjC5nL1yI1qmcBm0IwCh/exec";


    // --- Types (Mocked as objects) ---
    const Goal = {
      PRODUCT: 'product',
      OPPORTUNITY: 'opportunity',
      NONE: ''
    };

    const Step = {
      NAME_CAPTURE: 1,
      GOAL_SELECTION: 2,
      LEAD_FORM: 3,
      UNLOCKED: 4
    };

    // --- Constants ---
    const SCREENPAL_PRODUCT = 'https://go.screenpal.com/player/cOnljVn06MU?width=100%&embed=yes&autoplay=1';
    const SCREENPAL_OPPORTUNITY = 'https://go.screenpal.com/player/cOnljnn06Mm?width=100%&embed=yes&autoplay=1';

    const PACKAGES = [
      {
        name: 'Residential Package',
        srpRange: 'â‚±5,498 â€“ â‚±8,288',
        products: '25 A+ or 50 A+',
        pairingBonus: 'â‚±1,000 per match',
        maxPairing: 'â‚±3,000/day (â‚±90,000/month)',
        oneLegBonus: 'Up to â‚±4,000/day (â‚±120,000/month)',
        idealIncome: 'up to â‚±90,000/month',
        minIncome: 0,
        maxIncome: 90000,
        img: 'respack.png'
      },
      {
        name: 'Commercial Package',
        srpRange: 'â‚±13,778 â€“ â‚±19,488',
        products: '25 A+ / 50 A+ combo or 100 A+',
        pairingBonus: 'â‚±3,000 per match',
        maxPairing: 'â‚±9,000/day (â‚±270,000/month)',
        oneLegBonus: 'Up to â‚±28,000/day (â‚±840,000/month)',
        idealIncome: 'up to â‚±270,000/month',
        minIncome: 90001,
        maxIncome: 270000,
        img: 'compack.png'
      },
      {
        name: 'Industrial Package',
        srpRange: 'â‚±33,264',
        products: 'Combination of 25 A+, 50 A+, 100 A+',
        pairingBonus: 'â‚±7,000 per match',
        maxPairing: 'â‚±21,000/day (â‚±630,000/month)',
        oneLegBonus: 'Up to â‚±72,000/day (â‚±2.1M/month)',
        idealIncome: 'up to â‚±630,000+',
        minIncome: 270001,
        maxIncome: 10000000,
        img: 'indpack.png'
      }
    ];

    // --- AI Service ---
    const getAIAssistance = async (message, userName, goal) => {
      if (!API_KEY) {
        return "AI logic is ready! Please configure your Gemini API Key in the source code to enable chat.";
      }
      try {
        const genAI = new GoogleGenerativeAI(API_KEY);
        const model = genAI.getGenerativeModel({
          model: 'gemini-1.5-flash',
          systemInstruction: `You are an expert AI assistant for AVDTech, a Filipino technology company focusing on smart electrical system protection and automated product-based business opportunities. 
                    The user's name is ${userName}. Their current goal is ${goal}.
                    Be helpful, professional, and slightly enthusiastic. 
                    Keep answers concise. If asked about technical specs of AVDTech protectors, mention they improve power factor and provide voltage protection. 
                    If asked about the business, mention it uses AI automation and structured pairing bonuses.
                    Always guide the user back to the official FB page (facebook.com/link) for final transactions.`
        });

        const result = await model.generateContent(message);
        return result.response.text();
      } catch (error) {
        console.error("Gemini Error:", error);
        return "Pasensya na, medyo busy lang ang system. I suggest messaging us on Facebook for immediate help!";
      }
    };

    // --- Components ---
    const AIChat = ({ userName, goal }) => {
      const [messages, setMessages] = useState([
        { role: 'assistant', text: `Hi ${userName}! I'm the AVDTech AI. How can I help you today regarding your goal for ${goal}?` }
      ]);
      const [input, setInput] = useState('');
      const [loading, setLoading] = useState(false);
      const scrollRef = useRef(null);

      useEffect(() => {
        if (scrollRef.current) {
          scrollRef.current.scrollTop = scrollRef.current.scrollHeight;
        }
      }, [messages]);

      const handleSend = async () => {
        if (!input.trim() || loading) return;

        const userMsg = input.trim();
        setInput('');
        setMessages(prev => [...prev, { role: 'user', text: userMsg }]);
        setLoading(true);

        const response = await getAIAssistance(userMsg, userName, goal);
        setMessages(prev => [...prev, { role: 'assistant', text: response || '' }]);
        setLoading(false);
      };

      return (
        <div className="bg-white rounded-3xl border border-green-100 shadow-xl overflow-hidden max-w-lg w-full">
          <div className="bg-green-700 text-white p-4 flex items-center justify-between">
            <div className="flex items-center gap-2">
              <i className="fas fa-robot text-orange-400"></i>
              <span className="font-bold text-sm md:text-base">AVDTech AI Support</span>
            </div>
          </div>
          <div ref={scrollRef} className="h-64 md:h-80 overflow-y-auto p-4 space-y-4 bg-gray-50">
            {messages.map((m, i) => (
              <div key={i} className={`flex ${m.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                <div className={`max-w-[85%] p-3 rounded-2xl text-xs md:text-sm ${m.role === 'user' ? 'bg-orange-500 text-white rounded-br-none' : 'bg-white border border-gray-200 text-gray-800 rounded-bl-none shadow-sm'}`}>
                  {m.text}
                </div>
              </div>
            ))}
            {loading && (
              <div className="flex justify-start">
                <div className="bg-white border border-gray-200 p-3 rounded-2xl text-xs md:text-sm italic text-gray-500">
                  Thinking...
                </div>
              </div>
            )}
          </div>
          <div className="p-3 border-t bg-white flex gap-2">
            <input
              type="text"
              value={input}
              onChange={(e) => setInput(e.target.value)}
              onKeyPress={(e) => e.key === 'Enter' && handleSend()}
              placeholder="Type your question..."
              className="flex-1 p-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 text-sm"
            />
            <button onClick={handleSend} className="bg-green-600 text-white px-4 py-2 rounded-xl hover:bg-green-700">
              <i className="fas fa-paper-plane"></i>
            </button>
          </div>
        </div>
      );
    };

    const Modal = ({ type, onClose }) => {
      if (!type) return null;
      return (
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm fade-in">
          <div className="bg-white rounded-[30px] md:rounded-[40px] p-8 md:p-10 max-w-md w-full shadow-2xl relative border border-green-100">
            <button
              onClick={onClose}
              className="absolute top-6 right-6 text-gray-400 hover:text-gray-600 transition-colors"
            >
              <i className="fas fa-times text-xl"></i>
            </button>

            <div className="flex flex-col items-center text-center">
              <div className={`w-16 h-16 md:w-20 md:h-20 flex items-center justify-center rounded-2xl mb-6 text-3xl md:text-4xl ${type === 'device' ? 'bg-orange-50 text-orange-500' : 'bg-green-50 text-green-700'}`}>
                <i className={type === 'device' ? "fas fa-shopping-cart" : "fas fa-headset"}></i>
              </div>

              <h3 className="text-xl md:text-2xl font-bold text-green-900 mb-4">
                {type === 'device' ? 'Purchase a Device' : 'Talk to Admin'}
              </h3>

              <div className="text-green-800 leading-relaxed mb-6 text-sm md:text-base">
                {type === 'device' ? (
                  <>
                    Please Message us on our official Facebook page to purchase a device, the admin will get to you ASAP.
                    <br /><br />
                    Here's the link <br />
                    <a href="https://www.facebook.com/coachkuyatons" target="_blank" className="font-bold text-orange-600 break-all">https://www.facebook.com/coachkuyatons</a>
                  </>
                ) : (
                  <>
                    Message us here <a href="https://www.facebook.com/coachkuyatons" target="_blank" className="font-bold text-green-700 break-all">https://www.facebook.com/coachkuyatons</a> to talk to the admin.
                  </>
                )}
              </div>

              {type === 'admin' && (
                <div className="flex flex-col items-center gap-2 mt-2">
                  <p className="text-xs font-bold text-gray-400 uppercase tracking-widest">Or talk to AI</p>
                  <a
                    href="https://lime828.github.io/Test/AIagent.html"
                    target="_blank"
                    className="w-14 h-14 bg-orange-500 text-white rounded-full flex items-center justify-center shadow-lg hover:scale-110 transition-transform cursor-pointer"
                    title="Talk to AI"
                  >
                    <i className="fas fa-robot text-2xl"></i>
                  </a>
                </div>
              )}

              <button
                onClick={onClose}
                className={`mt-8 w-full py-4 rounded-full font-bold text-white transition-all shadow-lg ${type === 'device' ? 'bg-orange-500 hover:bg-orange-600 shadow-orange-100' : 'bg-green-700 hover:bg-green-800 shadow-green-100'}`}
              >
                Close
              </button>
            </div>
          </div>
        </div>
      );
    };

    // --- Main App ---
    const App = () => {
      const [step, setStep] = useState(Step.NAME_CAPTURE);
      const [user, setUser] = useState({
        firstName: '',
        goal: Goal.NONE,
        email: '',
        mobile: ''
      });
      const [errors, setErrors] = useState({});
      const [calculatedResult, setCalculatedResult] = useState(null);
      const [modal, setModal] = useState(null); // { type: 'device' | 'admin' }
      const [revealCalculator, setRevealCalculator] = useState(false);
      const [countdown, setCountdown] = useState(60);

      const submitLead = async (userData) => {
        if (!GOOGLE_SHEET_URL) return;
        try {
          // Flatten data for sheet
          const payload = {
            ...userData,
            timestamp: new Date().toLocaleString()
          };

          await fetch(GOOGLE_SHEET_URL, {
            method: 'POST',
            mode: 'no-cors',
            cache: 'no-cache',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });
        } catch (e) {
          console.error("Lead capture failed:", e);
        }
      };

      useEffect(() => {
        const savedStep = sessionStorage.getItem('avdtech_step');
        if (savedStep) {
          setStep(parseInt(savedStep));
        }

        const saved = sessionStorage.getItem('avdtech_user');
        if (saved) {
          try {
            const parsed = JSON.parse(saved);
            setUser(parsed);
          } catch (e) {
            console.error("Error restoring session", e);
          }
        }

        const revealed = sessionStorage.getItem('avdtech_revealed');
        if (revealed === 'true') {
          setRevealCalculator(true);
        }
      }, []);

      useEffect(() => {
        let timer;
        let interval;
        if (step === Step.UNLOCKED && !revealCalculator) {
          console.log("Timer started: Revealing in 60 seconds...");
          setCountdown(60);

          interval = setInterval(() => {
            setCountdown(prev => (prev > 0 ? prev - 1 : 0));
          }, 1000);

          timer = setTimeout(() => {
            setRevealCalculator(true);
            sessionStorage.setItem('avdtech_revealed', 'true');
            clearInterval(interval);
          }, 60000);
        }
        return () => {
          clearTimeout(timer);
          clearInterval(interval);
        };
      }, [step, revealCalculator]);

      const saveToSession = (update) => {
        const newUser = { ...user, ...update };
        setUser(newUser);
        sessionStorage.setItem('avdtech_user', JSON.stringify(newUser));
      };

      const nextStep = () => {
        let nStep = step;
        if (step === Step.NAME_CAPTURE) {
          if (!user.firstName.trim()) {
            setErrors({ firstName: "First name is required po." });
            return;
          }
          setErrors({});
          nStep = Step.GOAL_SELECTION;
        } else if (step === Step.GOAL_SELECTION) {
          if (user.goal === Goal.NONE) {
            setErrors({ goal: "Please select a goal to continue." });
            return;
          }
          setErrors({});
          nStep = Step.LEAD_FORM;
        } else if (step === Step.LEAD_FORM) {
          if (!user.email.includes('@') || !user.mobile) {
            setErrors({ lead: "Valid email and mobile are required." });
            return;
          }
          setErrors({});
          nStep = Step.UNLOCKED;

          // Submit to Google Sheets
          submitLead({
            firstName: user.firstName,
            email: user.email,
            mobile: user.mobile,
            goal: user.goal
          });
        }

        if (nStep !== step) {
          setStep(nStep);
          sessionStorage.setItem('avdtech_step', nStep.toString());
        }
      };

      const prevStep = () => {
        if (step > 1) {
          const pStep = step - 1;
          setStep(pStep);
          sessionStorage.setItem('avdtech_step', pStep.toString());
        }
      };

      const handleProductCalc = (e) => {
        e.preventDefault();
        const kwh = parseFloat(e.target.elements.kwh.value);
        if (isNaN(kwh) || kwh <= 0) return;

        let device = { name: '', srp: 0, range: '', repair: 0, img: 'https://images.pexels.com/photos/6958504/pexels-photo-6958504.jpeg?auto=compress&cs=tinysrgb&w=600' };
        if (kwh <= 250) {
          device = { ...device, name: '25 UF Device', srp: 5498, range: '100 - 250 kWH', repair: 15000, img: 'actsize25uf.png' };
        } else if (kwh <= 550) {
          device = { ...device, name: '50 UF Device', srp: 8288, range: '251 - 550 kWH', repair: 25000, img: 'actsize50uf.png' };
        } else {
          device = { ...device, name: '100 UF Device', srp: 19488, range: '551 - 1350 kWH', repair: 60000, img: 'actsize100uf.png' };
        }
        setCalculatedResult(device);
      };

      const handleOpportunityCalc = (e) => {
        e.preventDefault();
        const income = parseFloat(e.target.elements.income.value);
        if (isNaN(income) || income <= 0) return;

        let pkg = PACKAGES[0];
        if (income >= 270001) pkg = PACKAGES[2];
        else if (income >= 90001) pkg = PACKAGES[1];

        setCalculatedResult(pkg);
      };

      return (
        <div className="min-h-screen py-8 px-4 flex justify-center items-center">
          <div className="page-wrapper max-w-4xl w-full">

            {/* Step 1: Name Capture */}
            {step === Step.NAME_CAPTURE && (
              <div className="glass-card rounded-[30px] md:rounded-[40px] p-6 md:p-12 shadow-2xl fade-in">
                <h1 className="text-3xl md:text-5xl font-extrabold text-green-900 mb-4">Hi. Welcome po! ðŸ‘‹</h1>
                <p className="text-lg md:text-xl text-green-700 mb-8 font-light">May I know your first name para ma-assist kita nang maigi?</p>
                <div className="mb-8">
                  <label className="block text-xs font-bold tracking-[2px] uppercase text-green-600 mb-2">First Name</label>
                  <input
                    type="text"
                    value={user.firstName}
                    onChange={(e) => saveToSession({ firstName: e.target.value })}
                    onKeyPress={(e) => e.key === 'Enter' && nextStep()}
                    placeholder="ex. Juan"
                    className={`w-full p-4 md:p-5 rounded-full border-2 text-base md:text-lg focus:outline-none focus:ring-4 transition-all ${errors.firstName ? 'border-orange-500' : 'border-green-100 focus:ring-green-100'}`}
                  />
                  {errors.firstName && <p className="text-orange-600 text-sm mt-2 ml-4 font-semibold">{errors.firstName}</p>}
                </div>
                <button onClick={nextStep} className="w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-4 md:py-5 rounded-full shadow-lg shadow-orange-200 transition-all flex items-center justify-center gap-3 text-base md:text-lg group">
                  Continue <i className="fas fa-arrow-right group-hover:translate-x-1 transition-transform"></i>
                </button>
                <div className="mt-8 flex items-center gap-2 text-green-600/60 text-xs md:text-sm font-medium">
                  <i className="fas fa-leaf"></i> private & secure
                </div>
              </div>
            )}

            {/* Step 2: Goal Selection */}
            {step === Step.GOAL_SELECTION && (
              <div className="glass-card rounded-[30px] md:rounded-[40px] p-6 md:p-12 shadow-2xl fade-in">
                <button onClick={prevStep} className="text-green-700 font-bold flex items-center gap-2 mb-8 hover:gap-3 transition-all">
                  <i className="fas fa-arrow-left text-xs"></i> BACK
                </button>
                <h2 className="text-2xl md:text-4xl font-extrabold text-green-900 mb-2">Hi <span className="text-orange-600">{user.firstName}</span>.</h2>
                <p className="text-lg md:text-xl text-green-700 mb-8">Alin ba dito sa dalawa ang goal mo sa ngayon? <br /><span className="text-xs md:text-sm font-normal text-green-500">There is no right or wrong answer.</span></p>

                <div className="grid md:grid-cols-2 gap-4 md:gap-6 mb-8">
                  <div
                    onClick={() => saveToSession({ goal: Goal.PRODUCT })}
                    className={`p-6 md:p-8 rounded-[25px] md:rounded-[30px] border-2 cursor-pointer transition-all hover:-translate-y-1 ${user.goal === Goal.PRODUCT ? 'border-orange-500 bg-orange-50/30' : 'border-green-100 bg-white hover:border-green-400 shadow-lg shadow-green-900/5'}`}
                  >
                    <div className="w-16 h-16 md:w-20 md:h-20 flex items-center justify-center rounded-2xl bg-green-50 mb-4 md:mb-6 text-green-700 text-3xl md:text-4xl">
                      <i className="fas fa-house-lock"></i>
                    </div>
                    <h3 className="text-lg md:text-xl font-bold text-green-900 mb-2">Improve My Home's Electrical System.</h3>
                    <p className="text-green-700/70 text-xs md:text-sm leading-relaxed">Gusto kong maintindihan kung paano ang power efficiency ay makakatulong sa bahay ko.</p>
                  </div>

                  <div
                    onClick={() => saveToSession({ goal: Goal.OPPORTUNITY })}
                    className={`p-6 md:p-8 rounded-[25px] md:rounded-[30px] border-2 cursor-pointer transition-all hover:-translate-y-1 ${user.goal === Goal.OPPORTUNITY ? 'border-orange-500 bg-orange-50/30' : 'border-green-100 bg-white hover:border-green-400 shadow-lg shadow-green-900/5'}`}
                  >
                    <div className="w-16 h-16 md:w-20 md:h-20 flex items-center justify-center rounded-2xl bg-orange-50 mb-4 md:mb-6 text-orange-600 text-3xl md:text-4xl">
                      <i className="fas fa-briefcase"></i>
                    </div>
                    <h3 className="text-lg md:text-xl font-bold text-green-900 mb-2">Build a Product-Based Business.</h3>
                    <p className="text-green-700/70 text-xs md:text-sm leading-relaxed">I'm interested in making money from this product gamit ang isang automated system.</p>
                  </div>
                </div>

                {errors.goal && <p className="text-orange-600 text-sm mb-4 font-semibold text-center">{errors.goal}</p>}

                <button onClick={nextStep} className="w-full bg-green-700 hover:bg-green-800 text-white font-bold py-4 md:py-5 rounded-full shadow-lg shadow-green-100 transition-all flex items-center justify-center gap-3 text-base md:text-lg">
                  Continue <i className="fas fa-arrow-right"></i>
                </button>
              </div>
            )}

            {/* Step 3: Lead Form & Video Intro */}
            {step === Step.LEAD_FORM && (
              <div className="glass-card rounded-[30px] md:rounded-[40px] p-6 md:p-12 shadow-2xl fade-in">
                <button onClick={prevStep} className="text-green-700 font-bold flex items-center gap-2 mb-8 hover:gap-3 transition-all">
                  <i className="fas fa-arrow-left text-xs"></i> BACK
                </button>
                <h2 className="text-2xl md:text-3xl font-extrabold text-green-900 mb-2">Here's a Private Presentation for you <span className="text-orange-600">{user.firstName}</span></h2>
                <p className="text-green-700 mb-8 text-sm md:text-base">Tapusin mo ang video, bagay na bagay ito sa goal mo (Unlock mo lang ang video).</p>

                <div className="relative aspect-video rounded-[20px] md:rounded-[30px] overflow-hidden bg-black mb-8 shadow-2xl">
                  <iframe
                    src={user.goal === Goal.PRODUCT ? SCREENPAL_PRODUCT : SCREENPAL_OPPORTUNITY}
                    className="w-full h-full opacity-40 grayscale"
                    allowFullScreen
                  />
                  <div className="absolute inset-0 flex flex-col items-center justify-center bg-black/40 backdrop-blur-md text-white p-4 md:p-6 text-center">
                    <i className="fas fa-lock text-3xl md:text-5xl mb-4 text-orange-400"></i>
                    <h3 className="text-xl md:text-2xl font-bold mb-2">ACCESS LOCKED</h3>
                    <p className="text-xs md:text-sm opacity-90">Complete the form below to unlock the presentation.</p>
                  </div>
                </div>

                <div className="grid md:grid-cols-2 gap-4 md:gap-6 mb-8">
                  <div>
                    <label className="block text-xs font-bold tracking-[2px] uppercase text-green-600 mb-2">Email Address</label>
                    <input
                      type="email"
                      value={user.email}
                      onChange={(e) => saveToSession({ email: e.target.value })}
                      placeholder="you@example.com"
                      className="w-full p-4 rounded-2xl border-2 border-green-50 focus:outline-none focus:ring-4 focus:ring-green-100 transition-all text-sm"
                    />
                  </div>
                  <div>
                    <label className="block text-xs font-bold tracking-[2px] uppercase text-green-600 mb-2">Mobile Number</label>
                    <input
                      type="tel"
                      value={user.mobile}
                      onChange={(e) => saveToSession({ mobile: e.target.value })}
                      placeholder="+63 9xx xxx xxxx"
                      className="w-full p-4 rounded-2xl border-2 border-green-50 focus:outline-none focus:ring-4 focus:ring-green-100 transition-all text-sm"
                    />
                  </div>
                </div>

                {errors.lead && <p className="text-orange-600 text-sm mb-4 font-semibold text-center">{errors.lead}</p>}

                <button onClick={nextStep} className="w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-4 md:py-5 rounded-full shadow-lg shadow-orange-200 transition-all flex items-center justify-center gap-3 text-base md:text-lg">
                  UNLOCK FULL PRESENTATION <i className="fas fa-unlock"></i>
                </button>
              </div>
            )}

            {/* Step 4: Unlocked Content */}
            {step === Step.UNLOCKED && (
              <div className="space-y-8 fade-in">
                <div className="glass-card rounded-[30px] md:rounded-[40px] p-6 md:p-12 shadow-2xl">
                  <h2 className="text-2xl md:text-3xl font-extrabold text-green-900 mb-6">Enjoy the presentation, <span className="text-orange-600">{user.firstName}</span>!</h2>
                  <div className="aspect-video rounded-[20px] md:rounded-[30px] overflow-hidden bg-black shadow-2xl mb-8 md:mb-12">
                    <iframe
                      src={user.goal === Goal.PRODUCT ? SCREENPAL_PRODUCT : SCREENPAL_OPPORTUNITY}
                      className="w-full h-full"
                      allow="autoplay"
                      allowFullScreen
                    />
                  </div>

                  {/* DYNAMIC CALCULATOR - Revealed after 6 mins */}
                  {revealCalculator ? (
                    <div className="fade-in">
                      <div className="p-6 md:p-10 bg-white rounded-[30px] md:rounded-[40px] border border-orange-100 shadow-xl shadow-orange-900/5">
                        {user.goal === Goal.PRODUCT ? (
                          <>
                            <h3 className="text-xl md:text-2xl font-bold text-green-900 mb-4 flex items-center gap-3">
                              <i className="fas fa-calculator text-orange-500"></i> Ilang kWH ba ang nagagamit nyo sa bahay?
                            </h3>
                            <p className="text-green-700/70 mb-8 text-xs md:text-sm italic">Ang KWH ay nasa electric bill mo. Type mo lang sa ibaba to find the right device.</p>
                            <form onSubmit={handleProductCalc} className="flex flex-wrap gap-4 items-end">
                              <div className="flex-1 min-w-[200px]">
                                <input name="kwh" type="number" placeholder="ex. 350 kWh" className="w-full p-4 md:p-5 rounded-3xl border-2 border-green-50 focus:ring-4 focus:ring-green-100 outline-none text-sm" required />
                              </div>
                              <button type="submit" className="w-full md:w-auto bg-green-700 text-white px-8 md:px-10 py-4 md:py-5 rounded-3xl font-bold hover:bg-green-800 transition-all shadow-lg shadow-green-200 text-sm md:text-base">
                                Calculate Now
                              </button>
                            </form>

                            {calculatedResult && calculatedResult.srp && (
                              <div className="mt-8 md:mt-12 grid md:grid-cols-2 gap-6 md:gap-8 fade-in">
                                <div className="rounded-[25px] md:rounded-[30px] overflow-hidden bg-gray-50 border border-gray-100">
                                  <img src={calculatedResult.img} className="w-full h-40 md:h-48 object-cover" />
                                  <div className="p-5 md:p-6">
                                    <h4 className="font-black text-green-900 text-lg md:text-xl mb-1">{calculatedResult.name}</h4>
                                    <p className="text-green-600 text-xs md:text-sm mb-4">Recommended for {calculatedResult.range}</p>
                                    <p className="text-2xl md:text-3xl font-extrabold text-orange-500">â‚±{calculatedResult.srp.toLocaleString()}</p>
                                  </div>
                                </div>
                                <div className="bg-orange-50/50 p-6 md:p-8 rounded-[25px] md:rounded-[30px] border border-orange-100 flex flex-col justify-center">
                                  <h4 className="text-orange-700 font-bold uppercase tracking-wider text-[10px] md:text-xs mb-4">ESTIMATED SAVINGS</h4>
                                  <div className="flex items-center justify-between mb-2">
                                    <span className="text-xs md:text-sm text-green-700">Appliance Repair Est:</span>
                                    <span className="text-xs md:text-sm line-through text-gray-400">â‚±{calculatedResult.repair.toLocaleString()}</span>
                                  </div>
                                  <div className="flex items-center justify-between mb-6 pb-6 border-b border-orange-200">
                                    <span className="text-xs md:text-sm text-green-700">Device Price:</span>
                                    <span className="text-xs md:text-sm font-bold text-green-900">â‚±{calculatedResult.srp.toLocaleString()}</span>
                                  </div>
                                  <p className="text-[10px] md:text-xs text-green-700/60 mb-1">Total Long-term Savings</p>
                                  <p className="text-3xl md:text-4xl font-black text-green-800">â‚±{(calculatedResult.repair - calculatedResult.srp).toLocaleString()}</p>
                                </div>
                              </div>
                            )}
                          </>
                        ) : (
                          <>
                            <h3 className="text-xl md:text-2xl font-bold text-green-900 mb-4 flex items-center gap-3">
                              <i className="fas fa-coins text-orange-500"></i> How much income do you want?
                            </h3>
                            <p className="text-green-700/70 mb-8 text-xs md:text-sm italic">Enter your monthly desired income to see which package fits your goal.</p>
                            <form onSubmit={handleOpportunityCalc} className="flex flex-wrap gap-4 items-end">
                              <div className="flex-1 min-w-[200px]">
                                <input name="income" type="number" placeholder="ex. 50000" className="w-full p-4 md:p-5 rounded-3xl border-2 border-green-50 focus:ring-4 focus:ring-green-100 outline-none text-sm" required />
                              </div>
                              <button type="submit" className="w-full md:w-auto bg-green-700 text-white px-8 md:px-10 py-4 md:py-5 rounded-3xl font-bold hover:bg-green-800 transition-all shadow-lg shadow-green-200 text-sm md:text-base">
                                Match Package
                              </button>
                            </form>

                            {calculatedResult && calculatedResult.srpRange && (
                              <div className="mt-8 md:mt-12 grid md:grid-cols-3 gap-4 md:gap-6 fade-in">
                                <div className="bg-white p-5 md:p-6 rounded-[25px] md:rounded-[30px] border border-gray-100 shadow-sm text-center flex flex-col items-center justify-center">
                                  {calculatedResult.img ? (
                                    <div className="w-full aspect-square mb-4 overflow-hidden rounded-2xl">
                                      <img src={calculatedResult.img} alt={calculatedResult.name} className="w-full h-full object-cover" />
                                    </div>
                                  ) : (
                                    <i className="fas fa-box-open text-3xl md:text-4xl text-gray-200 mb-4"></i>
                                  )}
                                  <h4 className="font-bold text-green-900 mb-1 text-sm md:text-base">{calculatedResult.name}</h4>
                                  <p className="text-orange-600 font-bold text-sm md:text-base">{calculatedResult.srpRange}</p>
                                </div>
                                <div className="bg-green-50/30 p-5 md:p-6 rounded-[25px] md:rounded-[30px] border border-green-100">
                                  <h4 className="font-bold text-green-900 text-xs md:text-sm mb-4 border-b border-green-100 pb-2">Inclusions</h4>
                                  <ul className="text-[10px] md:text-xs space-y-2 text-green-800">
                                    <li><i className="fas fa-check text-green-600 mr-2"></i> Products: {calculatedResult.products}</li>
                                    <li><i className="fas fa-check text-green-600 mr-2"></i> Marketing Materials</li>
                                    <li><i className="fas fa-check text-green-600 mr-2"></i> Online Account</li>
                                  </ul>
                                </div>
                                <div className="bg-orange-50/30 p-5 md:p-6 rounded-[25px] md:rounded-[30px] border border-orange-100">
                                  <h4 className="font-bold text-orange-700 text-xs md:text-sm mb-4 border-b border-orange-100 pb-2">Potential</h4>
                                  <div className="text-[10px] md:text-xs space-y-1 text-orange-900">
                                    <p><strong>Max Pairing:</strong> {calculatedResult.maxPairing}</p>
                                    <div className="mt-4 p-2 bg-green-100 rounded-lg text-green-800 font-bold text-center">
                                      Target: {calculatedResult.idealIncome}
                                    </div>
                                  </div>
                                </div>
                              </div>
                            )}
                          </>
                        )}
                      </div>

                      {/* CTA AREA - Also revealed */}
                      <div className="mt-8 md:mt-12 flex flex-col items-center gap-6">
                        <div className="flex flex-wrap justify-center gap-4">
                          <button
                            onClick={() => setModal('device')}
                            className="bg-orange-500 hover:bg-orange-600 text-white px-6 md:px-8 py-3 md:py-4 rounded-full font-black text-sm md:text-lg transition-all shadow-xl shadow-orange-100 text-center"
                          >
                            <i className="fas fa-shopping-cart mr-2"></i>
                            {user.goal === Goal.PRODUCT ? 'GET YOUR DEVICE NOW' : 'GET YOUR PRODUCT PACKAGE'}
                          </button>
                          <button
                            onClick={() => setModal('admin')}
                            className="bg-green-700 hover:bg-green-800 text-white px-6 md:px-8 py-3 md:py-4 rounded-full font-black text-sm md:text-lg transition-all shadow-xl shadow-green-100"
                          >
                            <i className="fas fa-headset mr-2"></i> TALK TO ADMIN/AI
                          </button>
                        </div>
                      </div>
                    </div>
                  ) : (
                    <div className="text-center py-10 bg-green-50/50 rounded-[40px] border border-dashed border-green-200">
                      <p className="text-green-800/60 animate-pulse flex flex-col items-center justify-center gap-2">
                        <span className="flex items-center gap-2 italic">
                          <i className="fas fa-clock"></i> Next steps will appear in {countdown}s...
                        </span>
                        <span className="text-[10px] uppercase font-bold tracking-widest opacity-50">Please wait for the presentation to progress</span>
                      </p>
                    </div>
                  )}
                </div>

                {/* Testimonials - Only show if revealed? (Keeping visible for credibility) */}
                <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6 mb-12">
                  <div className="glass-card p-6 rounded-[25px] md:rounded-[30px] shadow-lg italic text-green-800 text-xs md:text-sm">
                    <p>"My electric bill dropped 22% after using the protector. Sulit na sulit!"</p>
                    <div className="mt-4 flex items-center gap-2 not-italic">
                      <div className="w-8 h-8 rounded-full bg-orange-400 flex items-center justify-center text-white font-bold text-[10px]">RM</div>
                      <span className="font-bold">Ricardo M.</span>
                    </div>
                  </div>
                  <div className="glass-card p-6 rounded-[25px] md:rounded-[30px] shadow-lg italic text-green-800 text-xs md:text-sm">
                    <p>"The AI system does the heavy lifting. Pure profit for my new side business."</p>
                    <div className="mt-4 flex items-center gap-2 not-italic">
                      <div className="w-8 h-8 rounded-full bg-green-600 flex items-center justify-center text-white font-bold text-[10px]">JC</div>
                      <span className="font-bold">J. Chan</span>
                    </div>
                  </div>
                  <div className="glass-card p-6 rounded-[25px] md:rounded-[30px] shadow-lg italic text-green-800 text-xs md:text-sm">
                    <p>"Dalawang beses na kaming nakapag-avail. Tibay at tipid talaga sa kuryente."</p>
                    <div className="mt-4 flex items-center gap-2 not-italic">
                      <div className="w-8 h-8 rounded-full bg-orange-400 flex items-center justify-center text-white font-bold text-[10px]">LT</div>
                      <span className="font-bold">Lorna T.</span>
                    </div>
                  </div>
                </div>
              </div>
            )}

            {/* Footer */}
            <footer className="mt-12 text-center text-[10px] tracking-[3px] text-green-800/40 uppercase font-black">
              Structured Â· Transparent Â· System-Based
            </footer>
            <Modal type={modal} onClose={() => setModal(null)} />
          </div>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);

  </script>
</body>

</html>